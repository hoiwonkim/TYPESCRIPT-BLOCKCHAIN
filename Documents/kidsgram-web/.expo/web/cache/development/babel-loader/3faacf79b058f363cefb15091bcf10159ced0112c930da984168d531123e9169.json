{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport Loading from \"./Loading\";\nimport styled from \"styled-components/native\";\nimport useLoggedInUser from \"../hooks/useLoggedInUser\";\nimport { useNavigation } from \"@react-navigation/native\";\nimport { useFollowUserMutation, useUnfollowUserMutation } from \"../generated/graphql\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Container = styled.View`\n  flex-direction: row;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px;\n`;\nvar UserContainer = styled.TouchableOpacity`\n  flex-direction: row;\n  align-items: center;\n`;\nvar UserAvatar = styled.Image`\n  width: 40px;\n  height: 40px;\n  border-radius: 50px;\n  margin-right: 10px;\n`;\nvar UserInfoContainer = styled.View`\n  display: flex;\n  flex-direction: column;\n`;\nvar Username = styled.Text`\n  font-weight: bold;\n  color: ${function (props) {\n  return props.theme.textColor;\n}};\n  font-size: 15px;\n  margin-bottom: 5px;\n`;\nvar Name = styled.Text`\n  font-weight: bold;\n  color: gray;\n  font-size: 14px;\n`;\nvar FollowButton = styled.TouchableOpacity`\n  background-color: ${function (props) {\n  return props.theme.activeColor;\n}};\n  padding: 10px 15px;\n  border-radius: 5px;\n  font-size: 14px;\n`;\nvar FollowButtonText = styled.Text`\n  font-weight: bold;\n  color: white;\n`;\nvar UserItem = function UserItem(_ref) {\n  var id = _ref.id,\n    username = _ref.username,\n    name = _ref.name,\n    avatarUrl = _ref.avatarUrl,\n    isFollowing = _ref.isFollowing,\n    isMe = _ref.isMe;\n  var followUsername;\n  var unfollowUsername;\n  var loggedInUser = useLoggedInUser();\n  var navigation = useNavigation();\n  var _useFollowUserMutatio = useFollowUserMutation({\n      update: function update(cache, _ref2) {\n        var _data$followUser$user, _data$followUser$user2;\n        var data = _ref2.data;\n        if ((data == null ? void 0 : data.followUser.ok) === false) {\n          return;\n        }\n        followUsername = data == null ? void 0 : (_data$followUser$user = data.followUser.user) == null ? void 0 : _data$followUser$user.username;\n        cache.modify({\n          id: `User:${data == null ? void 0 : (_data$followUser$user2 = data.followUser.user) == null ? void 0 : _data$followUser$user2.id}`,\n          fields: {\n            isFollowing: function isFollowing(_isFollowing) {\n              return true;\n            },\n            totalFollowers: function totalFollowers(_totalFollowers) {\n              return _totalFollowers + 1;\n            }\n          }\n        });\n        cache.modify({\n          id: `User:${loggedInUser == null ? void 0 : loggedInUser.id}`,\n          fields: {\n            totalFollowing: function totalFollowing(_totalFollowing) {\n              return _totalFollowing + 1;\n            }\n          }\n        });\n      }\n    }),\n    _useFollowUserMutatio2 = _slicedToArray(_useFollowUserMutatio, 2),\n    followUserMutation = _useFollowUserMutatio2[0],\n    followUserLoading = _useFollowUserMutatio2[1].loading;\n  var _useUnfollowUserMutat = useUnfollowUserMutation({\n      update: function update(cache, _ref3) {\n        var _data$unfollowUser$us, _data$unfollowUser$us2;\n        var data = _ref3.data;\n        if ((data == null ? void 0 : data.unfollowUser.ok) === false) {\n          return;\n        }\n        unfollowUsername = data == null ? void 0 : (_data$unfollowUser$us = data.unfollowUser.user) == null ? void 0 : _data$unfollowUser$us.username;\n        cache.modify({\n          id: `User:${data == null ? void 0 : (_data$unfollowUser$us2 = data.unfollowUser.user) == null ? void 0 : _data$unfollowUser$us2.id}`,\n          fields: {\n            isFollowing: function isFollowing(_isFollowing2) {\n              return false;\n            },\n            totalFollowers: function totalFollowers(_totalFollowers2) {\n              return _totalFollowers2 - 1;\n            }\n          }\n        });\n        cache.modify({\n          id: `User:${loggedInUser == null ? void 0 : loggedInUser.id}`,\n          fields: {\n            totalFollowing: function totalFollowing(_totalFollowing2) {\n              return _totalFollowing2 - 1;\n            }\n          }\n        });\n      }\n    }),\n    _useUnfollowUserMutat2 = _slicedToArray(_useUnfollowUserMutat, 2),\n    unfollowUserMutation = _useUnfollowUserMutat2[0],\n    unfollowUserLoading = _useUnfollowUserMutat2[1].loading;\n  var handleNavigateToProfileNavigation = function handleNavigateToProfileNavigation() {\n    navigation.navigate(\"StackProfileNavigation\", {\n      id: id,\n      username: username,\n      name: name,\n      avatarUrl: avatarUrl,\n      isFollowing: isFollowing,\n      isMe: isMe\n    });\n  };\n  var handleToggleFollow = function handleToggleFollow(isFollowing, username) {\n    if (followUserLoading === true || unfollowUserLoading === true) {\n      return;\n    }\n    if (isFollowing === false) {\n      followUserMutation({\n        variables: {\n          username: username\n        }\n      });\n    } else if (isFollowing === true) {\n      unfollowUserMutation({\n        variables: {\n          username: username\n        }\n      });\n    }\n  };\n  return _jsxs(Container, {\n    children: [_jsxs(UserContainer, {\n      onPress: handleNavigateToProfileNavigation,\n      children: [avatarUrl ? _jsx(UserAvatar, {\n        source: {\n          uri: avatarUrl\n        }\n      }) : _jsx(UserAvatar, {\n        source: require(\"../assets/basic_user.jpeg\")\n      }), _jsxs(UserInfoContainer, {\n        children: [_jsx(Username, {\n          children: username\n        }), _jsx(Name, {\n          children: name\n        })]\n      })]\n    }), !isMe && _jsx(FollowButton, {\n      onPress: function onPress() {\n        return handleToggleFollow(isFollowing, username);\n      },\n      children: _jsx(FollowButtonText, {\n        children: followUserLoading === true || unfollowUserLoading === true ? _jsx(Loading, {}) : isFollowing ? \"팔로우 취소\" : \"팔로우\"\n      })\n    })]\n  });\n};\nexport default UserItem;","map":{"version":3,"names":["Loading","styled","useLoggedInUser","useNavigation","useFollowUserMutation","useUnfollowUserMutation","jsx","_jsx","jsxs","_jsxs","Container","View","UserContainer","TouchableOpacity","UserAvatar","Image","UserInfoContainer","Username","Text","props","theme","textColor","Name","FollowButton","activeColor","FollowButtonText","UserItem","_ref","id","username","name","avatarUrl","isFollowing","isMe","followUsername","unfollowUsername","loggedInUser","navigation","_useFollowUserMutatio","update","cache","_ref2","_data$followUser$user","_data$followUser$user2","data","followUser","ok","user","modify","fields","totalFollowers","totalFollowing","_useFollowUserMutatio2","_slicedToArray","followUserMutation","followUserLoading","loading","_useUnfollowUserMutat","_ref3","_data$unfollowUser$us","_data$unfollowUser$us2","unfollowUser","_useUnfollowUserMutat2","unfollowUserMutation","unfollowUserLoading","handleNavigateToProfileNavigation","navigate","handleToggleFollow","variables","children","onPress","source","uri","require"],"sources":["C:/Users/GGPC/Documents/kidsgram-web/components/UserItem.tsx"],"sourcesContent":["import Loading from \"./Loading\";\r\nimport styled from \"styled-components/native\";\r\nimport useLoggedInUser from \"../hooks/useLoggedInUser\";\r\nimport { useNavigation } from \"@react-navigation/native\";\r\nimport { RootStackParamList } from \"../shared/shared.types\";\r\nimport { NativeStackNavigationProp } from \"@react-navigation/native-stack\";\r\nimport { useFollowUserMutation, useUnfollowUserMutation } from \"../generated/graphql\";\r\n\r\ntype UserItemNavigationProps = NativeStackNavigationProp<RootStackParamList>;\r\n\r\ninterface UserItemProps {\r\n  id: number;\r\n  username: string;\r\n  name: string;\r\n  avatarUrl: string;\r\n  isFollowing: boolean;\r\n  isMe: boolean;\r\n}\r\n\r\nconst Container = styled.View`\r\n  flex-direction: row;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 10px;\r\n`;\r\n\r\nconst UserContainer = styled.TouchableOpacity`\r\n  flex-direction: row;\r\n  align-items: center;\r\n`;\r\n\r\nconst UserAvatar = styled.Image`\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50px;\r\n  margin-right: 10px;\r\n`;\r\n\r\nconst UserInfoContainer = styled.View`\r\n  display: flex;\r\n  flex-direction: column;\r\n`;\r\n\r\nconst Username = styled.Text`\r\n  font-weight: bold;\r\n  color: ${(props) => props.theme.textColor};\r\n  font-size: 15px;\r\n  margin-bottom: 5px;\r\n`;\r\n\r\nconst Name = styled.Text`\r\n  font-weight: bold;\r\n  color: gray;\r\n  font-size: 14px;\r\n`;\r\n\r\nconst FollowButton = styled.TouchableOpacity`\r\n  background-color: ${(props) => props.theme.activeColor};\r\n  padding: 10px 15px;\r\n  border-radius: 5px;\r\n  font-size: 14px;\r\n`;\r\n\r\nconst FollowButtonText = styled.Text`\r\n  font-weight: bold;\r\n  color: white;\r\n`;\r\n\r\nconst UserItem = ({ id, username, name, avatarUrl, isFollowing, isMe }: UserItemProps) => {\r\n  let followUsername: string | undefined;\r\n  let unfollowUsername: string | undefined;\r\n  const loggedInUser = useLoggedInUser();\r\n  const navigation = useNavigation<UserItemNavigationProps>();\r\n  const [followUserMutation, { loading: followUserLoading }] = useFollowUserMutation({\r\n    update: (cache, { data }) => {\r\n      if (data?.followUser.ok === false) {\r\n        return;\r\n      }\r\n\r\n      followUsername = data?.followUser.user?.username;\r\n      cache.modify({\r\n        id: `User:${data?.followUser.user?.id}`,\r\n        fields: {\r\n          isFollowing: (isFollowing: boolean) => true,\r\n          totalFollowers: (totalFollowers: number) => totalFollowers + 1,\r\n        },\r\n      });\r\n      cache.modify({\r\n        id: `User:${loggedInUser?.id}`,\r\n        fields: {\r\n          totalFollowing: (totalFollowing: number) => totalFollowing + 1,\r\n        },\r\n      });\r\n    },\r\n  });\r\n  const [unfollowUserMutation, { loading: unfollowUserLoading }] = useUnfollowUserMutation({\r\n    update: (cache, { data }) => {\r\n      if (data?.unfollowUser.ok === false) {\r\n        return;\r\n      }\r\n\r\n      unfollowUsername = data?.unfollowUser.user?.username;\r\n      cache.modify({\r\n        id: `User:${data?.unfollowUser.user?.id}`,\r\n        fields: {\r\n          isFollowing: (isFollowing: boolean) => false,\r\n          totalFollowers: (totalFollowers: number) => totalFollowers - 1,\r\n        },\r\n      });\r\n      cache.modify({\r\n        id: `User:${loggedInUser?.id}`,\r\n        fields: {\r\n          totalFollowing: (totalFollowing: number) => totalFollowing - 1,\r\n        },\r\n      });\r\n    },\r\n  });\r\n\r\n  const handleNavigateToProfileNavigation = (): void => {\r\n    navigation.navigate(\"StackProfileNavigation\", {\r\n      id,\r\n      username,\r\n      name,\r\n      avatarUrl,\r\n      isFollowing,\r\n      isMe,\r\n    });\r\n  };\r\n\r\n  const handleToggleFollow = (isFollowing: boolean, username: string): void => {\r\n    if (followUserLoading === true || unfollowUserLoading === true) {\r\n      return;\r\n    }\r\n    if (isFollowing === false) {\r\n      followUserMutation({ variables: { username } });\r\n    } else if (isFollowing === true) {\r\n      unfollowUserMutation({ variables: { username } });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Container>\r\n      <UserContainer onPress={handleNavigateToProfileNavigation}>\r\n        {avatarUrl ? <UserAvatar source={{ uri: avatarUrl }}></UserAvatar> : <UserAvatar source={require(\"../assets/basic_user.jpeg\")} />}\r\n        <UserInfoContainer>\r\n          <Username>{username}</Username>\r\n          <Name>{name}</Name>\r\n        </UserInfoContainer>\r\n      </UserContainer>\r\n      {!isMe && (\r\n        <FollowButton onPress={() => handleToggleFollow(isFollowing, username)}>\r\n          <FollowButtonText>{followUserLoading === true || unfollowUserLoading === true ? <Loading /> : isFollowing ? \"팔로우 취소\" : \"팔로우\"}</FollowButtonText>\r\n        </FollowButton>\r\n      )}\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default UserItem;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}